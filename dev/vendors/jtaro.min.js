/*! JTaro.js v0.5.1 ~ (c) 2016-2017 Author:BarZu Git:https://github.com/chjtx/JTaro */
!function(o,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):o.JTaro=t()}(this,function(){"use strict";function o(o){return o.replace(/\/|\\/g,"__")}function t(){return Object.create({add:function(o,t){this[o]=t},remove:function(o){delete this[o]},run:function(){for(var o in this)this.hasOwnProperty(o)&&"function"==typeof this[o]&&this[o]()}})}var n=Object.create(null);return n.beforeEnter=t(),n.afterEnter=t(),n.beforeLeave=t(),n.tools={isEmptyObject:function(o){for(var t in o)if(o.hasOwnProperty(t))return!1;return!0}},n.install=function(t,e){function i(o,t){var e=o.options.beforeEnter;n.beforeEnter.run(),"function"==typeof e?e.call(n,function(o){t(o)})&&t():t()}function r(e){var i=t.options.components[o(e.jtaro_tag)].options.afterEnter;n.afterEnter.run(),"function"==typeof i&&i.call(e.$children[0],n.tools.isEmptyObject(n.params)?null:n.params),n.params=null}function s(e,i){var r=t.options.components[o(e.jtaro_tag)].options.beforeLeave;n.beforeLeave.run(),"function"==typeof r?r.call(e.$children[0],function(){i()})&&i():i()}function a(o,t){var e=o.$el,i=e.previousElementSibling;n.method&&n.method.call(o.$children[0],o.$children[0]),n.sliding=!0,t.utils.moveTo(e,w,0),setTimeout(function(){i&&t.utils.moveTo(i,-w*n.options.distance,0,n.options.duration,function(){var o=i.previousElementSibling;o&&(o.style.display="none")}),t.utils.moveTo(e,0,0,1===n.views.length?0:n.options.duration,function(){n.sliding=!1,r(o)})},0)}function l(o,t,e){var i=o.nextElementSibling;n.sliding=!0,i&&t.utils.moveTo(i,w,0,n.options.duration,e),t.utils.moveTo(o,0,0,n.options.duration,function(){n.sliding=!1;var t=o.previousElementSibling;t&&(t.style.display="block")})}function d(o,t,e,i){var s=o.length;s-1>i&&l(t[s-2],e,function(){o.splice(s-1),n.history.splice(s-1),window.sessionStorage.setItem("JTaro.history",JSON.stringify(n.history)),t[s-1].parentNode.removeChild(t[s-1]),setTimeout(function(){d(o,t,e,i)},0)}),s-1===i&&r(c(o[i]))}function u(o){var t=o.split("&"),n={};return t.forEach(function(o){var t=o.split("=");n[t[0]]=t[1]}),n}function c(o){for(var t=n.vm.$children,e=0,i=t.length;e<i;e++)if(t[e].jtaro_tag===o)return t[e]}function p(o,t){var e=o.replace("#","").split("?")[0],i=n.vm.$data.views,r=n.views.indexOf(e),s=c(e);m=e,r===-1?(i.indexOf(e)===-1?i.push(e):(n.vm.$el.appendChild(s.$el),a(s,t)),n.views.push(e),n.history.push({view:e,url:o.replace("#",""),params:n.tools.isEmptyObject(n.params)?null:n.params}),window.sessionStorage.setItem("JTaro.history",JSON.stringify(n.history))):d(n.views,n.vm.$el.childNodes,t,r)}function f(){w=window.innerWidth}function h(){var e=window.location.hash;if(""===e)return void(window.location.hash=n.options.default);var r=e.replace("#","").split("?")[0],s=t.options.components[o(r)];s&&i(s,function(o){o?n.method=o:n.method=null;var t=e.split("?");n.params={},t[1]&&(n.params=u(t[1])),p(e,n.options.JRoll)})}var v=document.getElementById("jtaro_style");v||(v=document.createElement("style"),v.id="jtaro_style",v.innerHTML="html,body{height:100%;padding:0;margin:0}#jtaro_app{position:relative;width:100%;height:100%;overflow:hidden}.jtaro-view{position:absolute;width:100%;height:100%;overflow:hidden;background:#fff;}",document.head.appendChild(v));var w=window.innerWidth,m="";e=e||{},n.views=[],n.history=[],n.version="0.5.1",n.options={JRoll:e.JRoll||window.JRoll,el:e.el||"#jtaro_app",default:e.default||"home",distance:isNaN(e.distance)?.1:Number(e.distance),duration:isNaN(e.duration)?200:Number(e.duration)};var g={props:["view"],data:function(){return{jtaro_tag:this.view}},render:function(n){return n(t.options.components[o(this.view)])},mounted:function(){a(this,n.options.JRoll)}};t.component("jt-view",g),t.prototype.postMessage=function(n,e){var i=c(e),r=t.options.components[o(e)],s=r?r.options.onMessage:null;i&&s&&s.call(i.$children[0],{message:n,origin:this.$parent.jtaro_tag})},t.prototype.go=function(o,t){if(!n.sliding){if(!isNaN(o))return void window.history.go(o);var e,i,r=o.replace("#",""),s=r.split("?"),a=n.views.indexOf(s[0]);if(~a&&(a=1-(n.views.length-a),a&&(o=a)),n.params={},t&&(n.params=t),s[1]){i=u(s[1]);for(e in i)i.hasOwnProperty(e)&&(n.params[e]=i[e])}"number"==typeof o?window.history.go(o):window.location.hash=o}},n.vm=new t({el:n.options.el,data:{views:[]},template:'<div id="'+n.options.el.replace("#","")+'"><jt-view class="jtaro-view" v-for="view in views" :view="view" :key="view"></jt-view></div>'}),window.addEventListener("hashchange",function(){function e(o){o?n.method=o:n.method=null,p(window.location.hash,n.options.JRoll)}if(""===window.location.hash)return window.sessionStorage.getItem("JTaro.history"),void(window.location.hash=n.options.default);var r=window.location.hash.replace("#","").split("?")[0];m?s(c(m),function(){i(t.options.components[o(r)],e)}):i(t.options.components[o(r)],e)}),window.addEventListener("resize",f),window.addEventListener("orientationchange",f);var y=null;""===window.location.hash?window.sessionStorage.getItem("JTaro.history"):(y=window.sessionStorage.getItem("JTaro.history"),n.afterEnter.add("__autoLoadHistoryPages__",function(){if(y&&y.length>1){var o=c(y.shift().view).$children[0];setTimeout(function(){o.go(y[0].url,y[0].params)},4)}})),y&&(y=JSON.parse(y)).length>1?window.history.go(1-y.length):h()},n});